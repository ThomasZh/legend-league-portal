<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Basic Page Needs
    ================================================== -->
  <meta charset="utf-8">
  <!--[if IE]><meta http-equiv="x-ua-compatible" content="IE=9" /><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NewsUp - News, Magazine and Article Directory Theme</title>
  <meta name="description" content="NewsUp is a multi-page oriented template perfect for NewsUp - News, Magazine, Blogging and Article Directory.">
  <meta name="keywords" content="news theme, magazine, blog, article directory, article submission, writer, author, publication, html, bootstrap">
  <meta name="author" content="Sempy Themes">

  <!-- Favicons
        ================================================== -->
  <link rel="shortcut icon" href="/static/newsup/img/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="/static/newsup/img/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/static/newsup/img/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/static/newsup/img/apple-touch-icon-114x114.png">

  <!-- Bootstrap
        ================================================== -->
  <link href="{{ static_url('newsup/css/bootstrap.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('newsup/css/bootstrap-tagsinput.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('newsup/css/jasny-bootstrap.min.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('css/font-awesome.min.css') }}" rel="stylesheet" type="text/css" />

  <!-- Animate
        ================================================== -->
  <link href="{{ static_url('newsup/css/effect2.css') }}" rel='stylesheet' type='text/css' />
  <link href="{{ static_url('newsup/css/animate.css') }}" rel='stylesheet' type='text/css' />

  <!-- Add fancyBox CSS files -->
  <link href="{{ static_url('newsup/js/fancybox/jquery.fancybox.css') }}" media="screen" rel="stylesheet" type="text/css" />

  <!-- Owl Slider CSS -->
  <link href="{{ static_url('newsup/css/owl.carousel.css') }}" media="screen" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('newsup/css/owl.theme.css') }}" media="screen" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('newsup/css/owl.transitions.css') }}" media="screen" rel="stylesheet" type="text/css" />

  <!-- Custom Css
        ================================================== -->
  <link href="{{ static_url('newsup/css/rs-wp-v1.2.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('newsup/css/jquery.rs.selectbox.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('css/style.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('newsup/css/responsive.css') }}" rel="stylesheet" type="text/css" />
  <link href="{{ static_url('css/self.css') }}" rel="stylesheet" type="text/css" />

  <!-- Custom Fonts
        ================================================== -->
  <link href="{{ static_url('newsup/fonts/stylesheet.css') }}" rel="stylesheet" type="text/css" />

  <!-- Google Fonts
        ================================================== -->
  <link href='http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script type="text/javascript" src="{{ static_url('newsup/js/jquery.1.11.1.js') }}"></script>

</head>

<body>

  <!--- Wrapper -->
  <section id="wrapper" class="clearfix">

    <!--- Header -->
    <header>

      <!-- socialbar -->
      {% module Template("newsup/block-socialbar.html", is_login=is_login) %}
      <!-- /socialbar -->

      <!-- menubar -->
      {% module Template("newsup/block-menubar.html") %}
      <!-- /menubar -->

    </header>
    <!--- End Header -->

    <!-- Page Breadcrumb -->
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <div class="rst-breadcrumb">
            <a href="/portal/newsup/index"><span>Home</span></a>
            <span>></span>
            <a href="/portal/newsup/category"><span>Sport</span></a>
            <span>></span>
            <a href="/portal/newsup/category"><span>Item Detail</span></a>
          </div>
        </div>
      </div>
    </div>
    <!-- End Page Breadcrumb -->

    <!-- Category Banner -->
    <section id="rst-catbanner-item">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="rst-catbanner-post">
              <div class="rst-mainslide">
                <img src="{{ article_info['img'] }}!800x370" alt="" />
                <div class="rst-boxinfo">
                  <a href="#"><span>
                    {% for category in article_info['categories'] %}
                      {{ category['title'] }}&nbsp;
                    {% end %}
                  </span></a>
                  <p><a href="#">{{ article_info['title'] }}</a></p>
                  <time><i class="fa fa-clock-o"></i>{{ article_info['publish_time'] }}</time>
                </div>
              </div>
            </div>
            <div class="rst-catbanner-listpost">
              {% for multimedia in multimedias %}
              <div class="rst-postpic">
                <a href="#"><img src="{{ multimedia['url'] }}!370x370" alt="" /></a>
              </div>
              {% end %}
              <div class="clear"></div>
            </div>
            <div class="clear"></div>
          </div>
        </div>
      </div>
    </section>
    <!-- End Category Banner -->

    <!-- Category Page Content -->
    <section id="rst-itemcontent">
      <div class="container">
        <div class="row">
          <div class="col-sm-8">
            <div class="rst-section-title rst-section-title-box rst-item-content-title">
              <h2>Heading 2</h2>
              <div class="rst-shortmenu">
                <p>
                  <span class="rst-item-comments"><i class="fa fa-eye"></i>{{ article_info['view_num'] }}</span>
                  <span class="rst-item-likes"><i class="fa fa-heart"></i>{{ article_info['like_num'] }}</span>
                  <span class="rst-item-comments"><i class="fa fa-comment"></i>{{ article_info['comment_num'] }}</span>
                  <span class="rst-item-author"><b>BY</b><a href="#">john doe</a></span>
                </p>
              </div>
            </div>
            <div class="row">
              <article class="col-xs-12 rst-item-content">
                <h5>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec eros at leo condimentum semper.</h5>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec eros at leo condimentum semper. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus eu auctor mauris. Aenean vestibulum aliquam orci sed ullamcorper. Sed
                  vitae dolor in ipsum elementum scelerisque. Praesent vulputate maximus nunc eget mollis. Suspendisse potenti. Morbi id diam mattis, vulputate lectus sit amet, mattis ligula.</p>
                <p>Nulla volutpat magna at varius cursus. Maecenas varius non nisi vel ultrices. Nullam justo neque, luctus nec congue non, ullamcorper vitae elit. </p>
                <blockquote>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec eros at leo condimentum semper. Lorem ipsum dolor sit amet, consectetur.
                </blockquote>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec eros at leo condimentum semper. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus eu auctor mauris. Aenean vestibulum aliquam orci sed ullamcorper. Sed
                  vitae dolor in ipsum elementum scelerisque. Praesent vulputate maximus nunc eget mollis. Suspendisse potenti. Morbi id diam mattis, vulputate lectus sit amet, mattis ligula.</p>
                <figure class="wp-caption alignleft">
                  <img src="https://tripc2c-club-title.b0.upaiyun.com/multimedia/2017/2/11/d2e8b9e2-14c1-4090-866d-c7f3780e3fdc!293x293" alt="" />
                </figure>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec eros at leo condimentum semper. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus eu auctor mauris. Aenean vestibulum aliquam orci sed ullamcorper. Sed
                  vitae dolor in ipsum elementum scelerisque. Praesent vulputate maximus nunc eget mollis. Suspendisse potenti. Morbi id diam mattis, vulputate lectus sit amet, mattis ligula.</p>
                <p>Nulla volutpat magna at varius cursus. Maecenas varius non nisi vel ultrices. Nullam justo neque, luctus nec congue non, ullamcorper vitae elit. Suspendisse eget quam tellus. Sed ac varius tortor. Nam vestibulum congue turpis at egestas.
                </p>
                <h3>Heading 3</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec eros at leo condimentum semper. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus eu auctor mauris. Aenean vestibulum aliquam orci sed ullamcorper. Sed
                  vitae dolor in ipsum elementum scelerisque. Praesent vulputate maximus nunc eget mollis. Suspendisse potenti. Morbi id diam mattis, vulputate lectus sit amet, mattis ligula.</p>
                <p>Integer vitae leo pulvinar, eleifend enim a, sodales dolor. Nam est elit, efficitur ut dapibus non, ornare vel magna. Praesent tempor, orci sit amet efficitur feugiat, ante neque rutrum urna, fermentum pretium ligula sem vel augue. Pellentesque
                  sit amet velit a neque pellentesque commodo eget in mauris.</p>
              </article>
              <!-- End Posts Contents -->

              <!-- like button -->
              <div class="row">
                <div class="col-xs-12">
                  <nav class="wp-pagenavi">
                    <a v-on:click="sendLike" class="rst-item-likes" style="cursor:pointer"><i id="like-icons" class="fa fa-3x fa-heart-o"></i></a>
                  </nav>
                </div>
              </div>
              <!-- / like button -->

              <div class="col-xs-12">
                <div class="rst-tagsandshare">
                  <div class="rst-catlist rst-catlisttags">
                    <a href="#">sport</a>
                    <a href="#">hockey</a>
                  </div>
                  <div class="rst-catlist rst-catlistshare">
                    <ul>
                      <li><a href="#" target="_blank"><i class="fa fa-facebook"></i></a></li>
                      <li><a href="#" target="_blank"><i class="fa fa-twitter"></i></a></li>
                      <li><a href="#" target="_blank"><i class="fa fa-dribbble"></i></a></li>
                      <li><a href="#" target="_blank"><i class="fa fa-behance"></i></a></li>
                    </ul>
                  </div>
                  <div class="clear"></div>
                </div>
              </div>
              <!-- End Tags and Share -->

              <!-- Comment list -->
              <div id="comment-list" class="col-xs-12 rst-content-comment">
                <div class="rst-section-title rst-section-title-box">
                  <h4>{{! comment_num }} Comments</h4>
                </div>
                <ol class="commentlist">

                  <li v-for="comment in comments" class="comment">
                    <div class="comment-container">
                      <div class="comment-avatar">
                        <img v-bind:src="comment.avatar" alt="" />
                      </div>
                      <div class="comment-data">
                        <div class="comment-header">
                          <a href="#" class="comment-author">{{! comment.nickname }}</a>
                          <time class="comment-date"><i class="fa fa-clock-o"></i>{{! comment.create_time }}</time>
                          <a href="#" class="comment-reply-link">REPLY</a>
                        </div>
                        <div class="comment-body">
                          <p>{{! comment.comment }}</p>
                        </div>
                      </div>
                    </div>
                  </li>
                </ol>
                <a id="loadMoreBtn" v-on:click="loadMore" class="rst-loadmore">more comments</a>
              </div>
              <!-- End comment list -->

            </div>
            <div class="row rst-comments">
              <div class="col-xs-12">
                <div class="rst-section-title rst-section-title-box">
                  <h4>Add Comment</h4>
                </div>
                <div class="rst-getintouch-form">
									<div class="row">
										<div class="col-xs-12">
											<textarea class="rst-pageinput" name="" id="comment" cols="30" rows="10" placeholder="Add your comment" ></textarea>
                      <div class="send-ok-message"></div>
											<input class="rst-pagebutton" type="button" v-on:click="sendComment" value="SEND"/>
										</div>
									</div>
								</div>
              </div>
            </div>
            <!-- End Comment Form -->
          </div>
          <div class="col-sm-4">
            <!-- begin widget social -->
            {% module Template("newsup/block-widget-social.html") %}
            <!-- end widget social -->

            <!-- begin widget popular -->
            {% module Template("newsup/block-widget-popular.html", populars=populars, news=news) %}
            <!-- end widget popular -->

            <!-- begin widget adv -->
            {% module Template("newsup/block-widget-adv.html", activities=activities) %}
            <!-- end widget adv -->

            <!-- begin widget video -->
            {% module Template("newsup/block-widget-video.html") %}
            <!-- end widget video -->

            {% module Template("newsup/block-widget-contactus.html") %}


          </div>
          <!-- End Content Sidebar -->
        </div>
      </div>
    </section>
    <!-- End Category Page Content -->

    <!-- Section Latest Comments -->
    {% module Template("newsup/block-lastest-comments.html", lastest_comments=lastest_comments) %}
    <!-- End Section Latest Comments -->

    <!-- Footer -->
    {% module Template("newsup/block-footer.html") %}
    <!-- End Footer -->

  </section>
  <!--- End Wrapper -->

  <!-- Bootstrap Js Compiled Plugins -->
  <script type="text/javascript" src="{{ static_url('newsup/js/bootstrap.min.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('newsup/js/bootstrap-tagsinput.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('newsup/js/jqBootstrapValidation.js') }}"></script>

  <!-- WoW Js -->
  <script type="text/javascript" src="{{ static_url('newsup/js/wow.min.js') }}"></script>

  <!-- Add Fancybox -->
  <script type="text/javascript" src="{{ static_url('newsup/js/fancybox/jquery.fancybox.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('newsup/js/fancybox/helpers/jquery.fancybox-media.js') }}"></script>

  <!-- Owl Slider Js -->
  <script type="text/javascript" src="{{ static_url('newsup/js/owl.carousel.js') }}"></script>

  <!-- Weather Js -->
  <!--
  <script type="text/javascript" src="{{ static_url('newsup/js/jquery.simpleWeather.js') }}"></script>
  -->

  <!-- Custome Selectbox Js -->
  <script type="text/javascript" src="{{ static_url('newsup/js/jquery.rs.selectbox.js') }}"></script>

  <script type="text/javascript" src="{{ static_url('js/main.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('js/json2.js') }}"></script>
  <script src="{{ static_url('js/vue-2.1.4.js') }}" type="text/javascript"></script>

  <script>
    new Vue({
      el: '#rst-itemcontent',
      data: {
        comments: [],
        comment_num: 0,
        limlt: 20
      },
      created: function() {
        this.queryComments(0, this.limlt);
      },
      methods: {
        sendLike: function() {
          console.log('like');
          $.ajax({
            type: "POST",
            url: "/api/articles/{{ article_info['_id'] }}/like",
            dataType: "json",
            contentType: 'application/json',
            success: function(data, status, xhr) {
              console.log(data);
              $("#like-icons").removeClass("fa-heart-o").addClass("fa-heart");
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
              if (XMLHttpRequest.status == 200) {
                $("#like-icons").removeClass("fa-heart-o").addClass("fa-heart");
              }
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        },
        sendComment: function() {
          var _self = this;
          var comment = $("#comment").val();
          console.log(comment);
          var data = {
            "comment": comment,
          };
          var json = JSON.stringify(data);
          console.log(json);
          function hide(){
            $(".send-ok-message").hide(1000);
          }
          $.ajax({
            type: "POST",
            url: "/api/articles/{{ article_info['_id'] }}/comment",
            dataType: "json",
            data: json,
            contentType: 'application/json',
            success: function(data, status, xhr) {
              console.log(data);
              $("#comment").val("");
              _self.queryNewComment();

            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
              if (XMLHttpRequest.status == 200) {
                $(".send-ok-message").html("留言成功！");
                setTimeout(hide,3000);
                $("#comment").val("");
                _self.queryNewComment();
              }
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        },
        loadMore: function() {
          var _self = this;
          $("#loadMoreBtn").text('Loading...');
          _self.queryComments(_self.comment_num, _self.limlt);
          setTimeout(function(){
            if (_self.comment_num % _self.limlt == 0){
              $("#loadMoreBtn").text('More comments');
            } else {
              $("#loadMoreBtn").css('display','none');
            }
          }, 1000);
          // setTimeout(function(){
          //   $("#loadMoreBtn").css('display','none');
          // }, 1000);
        },
        getLocalTime: function(nS) { //时间戳转换
           return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');
        },
        queryComments: function(idx, limit) {
          var _self = this;
          $.ajax({
            type: "GET",
            url: "/api/articles/{{ article_info['_id'] }}/comment?idx=" + idx + "&limit=" + limit,
            async: false,
            dataType: "json",
            contentType: 'application/json',
            success: function(datas, status, xhr) {
              console.log(datas);
              for(var i = 0, l = datas.length; i < l; i++) {
                datas[i].create_time = _self.getLocalTime(datas[i].create_time);
                // console.log(datas[i].create_time);
                _self.comments.push(datas[i]);
                _self.comment_num += 1;
              }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        },
        queryNewComment: function() {
          var _self = this;
          $.ajax({
            type: "GET",
            url: "/api/articles/{{ article_info['_id'] }}/comment?idx=0&limit=1",
            async: false,
            dataType: "json",
            contentType: 'application/json',
            success: function(datas, status, xhr) {
              console.log(datas);
              for(var i = 0, l = datas.length; i < l; i++) {
                datas[i].create_time = _self.getLocalTime(datas[i].create_time);
                _self.comments.splice(0, 0, datas[i]);
                _self.comment_num += 1;
              }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        },
      }
    });
  </script>

</body>

</html>
