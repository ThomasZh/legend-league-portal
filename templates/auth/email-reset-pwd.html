<!DOCTYPE HTML>
<html>

<head>
  <title>密码重置-UI中国-专业界面交互设计平台</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="Keywords" content="ui设计,界面设计,ui平台,学ui,ui教程,ui源文件,ui下载,ui问答,ui杂志,ui活动,ui软件,ui工具,ui灵感,ui经验">
  <meta name="Description" content="UI中国,前身为iconfans.com。是专业的界面设计师交流、学习/展示平台.同时也是UI设计师人才流动的集散地,会员均为一线UI设计师,覆盖主流互联网公司.我们希望借助互联网的力量打造国内最专业的UI设计平台,为UI设计师做最好的服务,提高UI设计行业价值!">

  <link rel="icon" href="{{ static_url('img/logo.ico') }}" type="image/png/ico">
  <link rel="stylesheet" href="{{ static_url('uicn/css/base.css') }}">
  <link rel="stylesheet" href="{{ static_url('uicn/css/login-fluid.css') }}">
  <link rel="stylesheet" href="{{ static_url('uicn/css/verify.css') }}">
  <link rel="stylesheet" href="{{ static_url('uicn/css/iconfont.css') }}">
  <script src="{{ static_url('uicn/js/jquery.js') }}"></script>
  <script src="{{ static_url('uicn/js/msgTip.js') }}"></script>
  <script src="{{ static_url('uicn/js/placeholder.js') }}"></script>
  <script src="{{ static_url('uicn/js/Validform_v5.3.2.js') }}"></script>
  <script src="{{ static_url('uicn/js/md5.min.js') }}" type="text/javascript"></script>
  <script src="{{ static_url('js/json2.js') }}" type="text/javascript"></script>
</head>

<body>
  <div class="wp cl">
    <div class="log-wrap cl">
      <div class="log-hd">
        <div class="wpl cl">
          <div class="log-row cl">
            <div class="log-logo">
              <a href="/"> <img src="{{ static_url('img/logo-64.png') }}" srcset="{{ static_url('img/logo-128.png') }} 2x" /> </a>
            </div>
            <div class="log-title">
              <strong>密码重置</strong>
              <p>请按要求设置您的新密码</p>
            </div>
          </div>
        </div>
      </div>
      <div class="log-content cl">
        <div class="wpl pos cl">
          <div class="log-row-cx cl">
            <div class="reg_left pos z">
              <form id="LoginForm">
                <label class="login-icon pos">
                  <i class="iconfont fss log-i icon-lock-line"></i>
                  <input id="newpass" type="text" name="newpass" value="请输入您的新密码" class="log-input login-pwd mls" />
                </label>
                <button id="re-button" class="lang-btn lang-btn-huge lang-btn-fixed-Large mtw">
                  <span class="lang-btn-content">立即重置</span>
                </button>
              </form>
              <div class="log-cartoon"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="log-footer cl">
      <div class="wpl cl">
        <div class="log-row cl">
          <p style="display:block;width:100%;text-align:center;">京ICP备14007358号-1 \ 京公网安备11010802014104号 \ Powered by © 2008-2016 UI.CN</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    //用户框失去、得到焦点事件处理

    var newpass_10 = '<span id="password_qsr" class="user-input-er-span"><b></b><i class="iconfont"></i></span>';
    var renewpass_10 = '<span id="password_qqe" class="user-input-er-span"><b></b><i class="iconfont"></i></span>';
    var renewpass_20 = '<span id="password_errtext" class="user-input-er-span"><b>需至少6位</b><i class="iconfont"></i></span>';
    var renewpass_30 = '<span id="password_byz" class="user-input-er-span"><b>两次输入不符</b><i class="iconfont"></i></span>';
    var code_10 = '<span id="password_code" class="user-input-er-span"><b></b><i class="iconfont"></i></span>';

    var newpassdef = $('#newpass').val();
    var repassdef = $('#repass').val();
    $('#newpass').blur(function() {
      if ($.trim($(this).val()).length <= 0 || $.trim($(this).val()) == newpassdef) {
        $(this).val(newpassdef);
        //globalTip({'msg':'请输入您的新密码'});
        $("#newpass").after(newpass_10);
        $(this).attr('type', 'text');
        $(this).parent().removeClass('login-on'); //给#username的父元素添加class
      } else if ($(this).val().length < 6) {
        $("#password_errtext").remove();
        $("#newpass").after(renewpass_20);
        return false;
      }
      $("#password_errtext").remove();
    }).focus(function() {
      $(this).parent().addClass('login-on');
      if ($(this).val() == newpassdef)
        $(this).val('');
      $(this).attr('type', 'password');
      $("#password_errtext").remove();
      $("#password_qsr").remove();
    });


    $('#re-button').click(function() {
      console.log('button');

      //是否为空
      if ($("#newpass").val() == '' || $("#newpass").val() == '请输入您的新密码') {
        globalTip({
          'msg': '请输入您的新密码'
        });
        return false;
      }


      var data = {
        email: "{{ email }}",
        ekey: "{{ ekey }}",
        pwd: $.md5($("#newpass").val()),
        code: "eHfWk+OqSWaR7FhDTkW/d7TIZqP3q0W3nVGXKZY5A8Q="
      };
      var json = JSON.stringify(data);
      console.log(data);

      $.ajax({
        type: "POST",
        url: "/api/auth/email/reset-pwd",
        data: json,
        crossDomain: true,
        dataType: "json",
        contentType: 'application/json',
        success: function(data, status, xhr) {
          console.log(data);
          redirectTip('密码已经重置，请重新登录!', true, '/portal/auth/login', 0);
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
          console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
          if (XMLHttpRequest.status == 200) {} else {
            redirectTip('网络异常,刷新重试', true, '/portal/auth/reset-pwd?email={{ email }}&ekey={{ ekey }}', 3);
          }
        },
        complete: function(XMLHttpRequest, textStatus) {
          this; // 调用本次AJAX请求时传递的options参数
        }
      });

      return false;
    });
  </script>

</body>

</html>
